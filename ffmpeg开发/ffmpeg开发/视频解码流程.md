## 多媒体文件解码流程图

![](https://note.youdao.com/yws/api/personal/file/WEBac42a843ff94a747f1c119a665926244?method=download&shareKey=2fe86ab7c67720a3140b350a5a502b02)

* 1.获取媒体文件格式信息：使用avformat_open_input通过文件获取AVFormatContext结构。

* 2.找到视频流：调用avformat_find_stream_info，传入AVFormatContext，读取视频中一段数据，并且解码(函数内部操作)，之后根据解码数据填充AVFormatContext中流信息。

* 3.找到合适的视频流：调用av_find_best_stream，传入AVFormatContext，自动搜索到合适的视频流索引，或是循环判断AVFormatContext中的每个streams的codecpar->codec_type来找到对应的视频流索引(对应的streams数组中的下标)。

* 4.查找对应的解码器：调用avcodec_find_decoder，传入AVFormatContext中结构streams里对应的流的codecpar->codec_id，来返回一个解码器。

* 5.初始化编码器参数：调用avcodec_parameters_to_context，传入AVCodecContext结构与AVFormatContext中结构streams里对应的流的codecpar，来初始化解码器上下文的参数

* 6.打开编码器：调用avcodec_open2，传入解码器上下文与解码器，打开该解码器，之后解码器上下文可以接收数据并进行解码。

* 7.初始化SwsContext结构，该结构为原始数据格式化上下文结构，为后面的格式化做准备。

---开始循环


---结束循环