[toc]

## 栈区

go的栈区同c语言，一般函数都在栈上，以下几个方面的变量都在栈上。

* 函数的入参
* 函数中定义的变量
* 小型局部变量与new和make创建的变量。(该变量创建空间对当前线程栈来说仍然能够接受时)

## 堆区

go的堆由go语言内部自行分配，当出现以下情况时，变量分配在堆上。

* 变量从栈上逃逸
* 栈上分配的大型局部变量。(该变量创建空间对当前线程栈来说过大)

## 逃逸

逃逸指的是变量从栈上转移到堆上，此时该变量会受到GC的影响。

逃逸一般发生在如下几个情况

1. new或普通创建的变量，指针作为函数返回值返回。
2. 变量的指针被逃逸的变量(如逃逸结构体的成员)引用或全局变量引用
3. 指针被指针类型的切片、map、chan引用
4. 定义全局变量