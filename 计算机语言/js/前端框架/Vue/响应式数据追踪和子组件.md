[toc]

## 响应式数据的追踪

如果vue需要在页面中追踪数据的变化，必须对暴露出的数据使用ref等函数进行包装。

* Vue 的响应式系统是基于**getter/setter（Vue 2）或 Proxy（Vue 3）**的。写一个普通变量，是不会被包裹、不会被代理的，Vue 根本就不知道它改了。

* ref对象在绑定后，不要操作对象本身，因为第一次绑定后，VUE只认旧的对象
* 如果不使用ref对象，则相当于无法修改的显示。

### ref绑定

用于绑定一般数值

```vue
<template>
	<div>
		姓名: <input v-model="userName"/> {{userName}} <br />		<!-- 使用v-model绑定变量 -->
      																										 <!-- {{}} 用于在html中访问vue变量-->
      薪水: <input type="number" v-model="salary"/> {{salary}} <br />	
		<button v-on:click="addSalary">提交</button>		<!-- 绑定方法 -->
	</div>
</template>

<!-- vue3写法 -->
<script setup lang="ts">
import { ref } from 'vue';
let userName=ref('roy')
let salary=15000
function addSalary(){
  salary.value+=1000
}
</script>

<style scoped>

</style>
```

* ref创建出的对象，其属性不具备双向绑定功能，必须使用reactive创建对象或使用别方法处理才有双向绑定功能。

### reactive

用于绑定对象

```vue
<template>
	<div>
		姓名: <input v-model="salaryInfo.userName"/> {{salaryInfo.userName}} <br />		<!-- 使用v-model绑定变量 -->
      																										 <!-- {{}} 用于在html中访问vue变量-->
      薪水: <input type="number" v-model="salaryInfo.salary"/> {{salaryInfo.salary}} <br />	
		<button v-on:click="addSalary">提交</button>		<!-- 绑定方法 -->
	</div>
</template>

<!-- vue3写法 -->
<script setup lang="ts">
import { reactive } from 'vue';
let salaryInfo=reactive({userName:'roy',salary:15000})
function addSalary(){
  salaryInfo.salary+=1000
}
</script>

<style scoped>

</style>
```

### toRef/toRefs

用于将目标转换为ref对象

```vue
<template>
	<div>
		姓名: <input v-model="userName"/> {{userName}} <br />		<!-- 使用v-model绑定变量 -->
      																										 <!-- {{}} 用于在html中访问vue变量-->
      薪水: <input type="number" v-model="salary"/> {{salary}} <br />	
		<button v-on:click="addSalary">提交</button>		<!-- 绑定方法 -->
	</div>
</template>

<!-- vue3写法 -->
<script setup lang="ts">
import { reactive,toRef } from 'vue';
let salaryInfo=reactive({userName:'roy',salary:15000})
let userName = toRef(salaryInfo,'userName')
let salary = toRef(salaryInfo.salary)

<!-- 另外一种 -->
let {userName,salary} = toRefs(salaryInfo)

function addSalary(){
  salary+=1000
}
</script>

<style scoped>

</style>
```

## 自定义组件和子组件暴露入参和出参

### 子组件向父组件传参

`com.vue`

```vue
<template>
	<div>
		姓名: <input v-model="userName"/> {{userName}} <br />		<!-- 使用v-model绑定变量 -->
      																										 <!-- {{}} 用于在html中访问vue变量-->
      薪水: <input type="number" v-model="salary"/> {{salary}} <br />	
	</div>
</template>

<script lang="ts">
	export default {
		name:"SalaryInfo"
	}
</script>

<script setup lang="ts">
import {ref} from 'vue';

let userName=ref('roy')
let salary = ref(15000)
defineExpose({userName,salary})			//暴露出组件需要暴露的变量
  
</script>

<style scoped>
</style>
```

`app.vue`

```vue
<template>
	<div>
    <com ref="salaryInfo"></com> //将组件绑定给salaryInfo
    <button @click="showRes">hello</button>
  </div>
</template>

<script setup lang="ts">
import {ref} from 'vue';
import com from "./components/com.vue"
let salaryInfo = ref()			//从子组件拿到暴露出的代理变量

function showRes(){
  console.log(salaryInfo)
  console.log(salaryInfo.value.userName)
}

</script>
<style scoped>
</style>
```

### 父组件向子组传参

`com.vue`

```vue
<template>
	<div>
    <!-- 下面的会爆红 因为不知道入参salaryInfo是否有userName和salary属性 -->
    <!-- 需要在types中暴露出类型 -->
		姓名: <input v-model="salaryInfo.userName"/> <br />		<!-- 使用v-model绑定变量 -->
      																										 <!-- {{}} 用于在html中访问vue变量-->
      薪水: <input type="number" v-model="salaryInfo.salary"/> <br />	
    {{salaryInfo}}
	</div>
</template>

<script lang="ts">
	export default {
		name:"SalaryInfo"
	}
</script>

<script setup lang="ts">

  defineProps([
    'salaryInfo'
  ])
  
  <!-- 明确入参类型的方法 -->
  <!-- import type {SalaryInfo} from "@/types/salaryInfo"		//导入类型    -->
  <!-- defineProps<salaryInfo.SalaryInfo>()									//声明暴露的入参类型    -->
   
</script>

<style scoped>
</style>
```

`app.vue`

```vue
<template>
	<div>
    <com :salary-info="salaryInfo"></com> <!-- 将子组件中的salary-info绑定给父组件的salaryInfo。HTML属性命名规范使用 kebab-case，组件内使用 camelCase。-->
    <button @click="showRes">hello</button>
  </div>
</template>

<script setup lang="ts">
import {ref} from 'vue';
import com from "./components/com.vue"

let salaryInfo = reactive({
  userName:'roy',salary:15000
})

function showRes(){
  salaryInfo.salary+=1000
}

</script>
<style scoped>
</style>
```

## vue组件生命周期

vue组件在创建时都需要经历以犀利的初始化步骤，这些步骤中有一些钩子函数。

vue组件一共有四个阶段允许用户使用钩子函数：创建、挂载、更新、销毁。

### OptionsAPI的生命周期函数

* 创建阶段：beforeCreate、created
* 挂载阶段：beforeMount、mounted
* 更新阶段：beforeUpdate、updated
* 销毁阶段：beforeDestroy、destroyed

### CompositionAPI的生命周期函数

* 创建阶段：setup
* 挂载阶段：onBeforeMount、onMounted
* 更新阶段：onBeforeUpdate、onUpdated
* 销毁阶段：onBeforeUnmount、onUnmounted