[toc]

## mDNS

### 介绍

多播DNS（Multicast DNS，简称mDNS）是一种用于局域网（LAN）内设备自动进行域名解析的协议。它在没有中央DNS服务器的情况下，允许设备自我注册和查询主机名、IP 地址等信息。mDNS 使用与标准DNS相同的报文格式。mDNS通常和DNS-SD一起使用，用于服务发现和名称解析。

### 工作原理

mDNS使用IP组播（Multicast）技术，通过发送DNS查询和响应报文来实现主机名到IP地址的解析。mDNS使用固定的IPv4多播地址`224.0.0.251`和IPv6多播地址`FF02::FB`，在UDP端口`5353`上进行通信。以下是mDNS的工作步骤：

1. **启动和自注册**：
   每个设备启动时，会选择一个主机名（如 "hostname.local"）并通。过向mDNS的组播地址发送查询请求，询问这个主机名是否已经存在。如果没有冲突，设备就会使用这个主机名注册自己。
2. **冲突检测和名称分配**：
   如果已有设备使用相同的主机名，新设备需要尝试不同的名称，直到选定一个唯一的主机名。
3. **名称解析**：
   当设备需要解析某个主机名的IP地址时，它会发送一个mDNS查询报文到局域网内的多播地址，所有接收到报文的设备都会检查查询的主机名是否匹配。如果匹配，它们会回复一个响应报文，包含相应的IP地址信息。

## DNS-SD

### 介绍

DNS-SD（DNS-Based Service Discovery，即基于DNS的服务发现）是一个网络协议框架，它基于mDNS实现。DNS-SD主要用于在本地网络中自动发现并使用网络服务，如打印机、文件共享、媒体播放等。

#### 记录类型

DNS-SD 中采用了多个特定的 DNS 记录类型来进行服务的发现和信息传递：

- **PTR 记录**：用于枚举网络中某一类型的所有服务。例如，"_http._tcp.local" PTR 记录列出了网络中所有的 HTTP 服务。
- **SRV 记录**：提供具体的服务主机名和端口信息；每个服务有一个或者多个 SRV 记录。
- **TXT 记录**：用来存储与服务相关的任意文本信息，如服务的配置选项等。
- **A/AAAA 记录**：将服务主机名解析为一个或多个 IP 地址。

### 工作原理

DNS-SD借助于多播DNS（mDNS），在本地网络内进行服务的发现和发布。以下是DNS-SD的基本工作原理：

1. **服务注册**：
   服务提供者自注册。该信息通常包括服务名称、类型（如 "_http._tcp"）、端口号、及其他附加参数。

   该信息通过mDNS发送到局域网内所有设备。

2. **服务发现**：
   客户端在本地网络中查询特定类型的服务。例如，客户端广播一个查询，想找到所有的 "_http._tcp" 服务。其它设备收到这个查询后，会响应其提供的服务信息。

   该信息通过mDNS发送到局域网内所有设备。

3. **服务解析**：
   客户端在发现服务后，可以进一步解析获取具体的服务细节。例如，从服务名称解析出具体的 IP 地址和端口号。