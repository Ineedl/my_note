[toc]

## 文档版本号

每个文档都有一个`_version`号码，这个号码在文档被改变时加`1`，Elasticsearch使用这个`_version`保证所有修改都被正确排序。当一个旧版本出现在新版本之后，它会被简单的忽略。

* _version可以用于乐观锁
* _version字段在文档被重复删除时，也会增加

## 相关性算分

当使用match查询时，文档结果会根据与搜索词条的关联度打分(_score)，返回时会按照分数值降序排列。

### 词条频率

词条频率为词条在数据中出现的频率
```
TF(词条频率)=词条出现次数/文档中词条总数
```

### 逆文档频率

* 逆文档频率使用TF-IDF算法实现

```
IDF(逆文档频率)=log2(文档总数/包含词条的文档总数)
```

### source计算

#### 5.1前使用的算法

* 注意 有 ∑ 累加是因为输入数据可能被分词，source是对分词和未分词的所有单词的TF和IDF相乘后累加而获取的值
* 该算法受词频影响较大，词频越高，分数越大，几乎会无限增加。

```
source = ∑ TF*IDF
```

#### 后续版本新算法

使用BM25算法

* BM25算法受到词频影响较小，词频越高，分数增长曲线会趋近于水平

