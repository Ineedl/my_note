[toc]

## 特性

相当于Java里的标签。

* 特性用于在运行时传递程序中各种元素（比如类、方法、结构、枚举、组件等）的行为信息的声明性标签，用于添加元数据，如编译器指令和注释、描述、方法、类等其他信息

### 特性的使用

```
[attribute(positional_parameters, name_parameter = value, …)]
element
```

- positional_parameters： 表示特性必须具备的信息，一般由特性自身定义
- name_paramete：表示特性可选的信息，一般由特性自身定义
- element： 特性生效目标，如变量、接口、类、函数、函数参数等。

### 自定义特性的声明与使用

```
public class <attributeName>Attribute : Attribute{
	....
}
```

`例子`

```
public class TestAttribute : Attribute
{
    public int Parm { get; set; }

    private int id;
    private string name;

    public TestAttribute()
    {

    }

    public TestAttribute(int id, string name)
    {
        this.id = id;
        this.name = name;
    }
}

[Test]  // 使用无参构造函数
public class TestClass1
{

}

[Test(Parm = 123)]  // 使用无参构造函数 + 指定参数
public class TestClass2
{

}

[Test(1, "test")]   // 使用有参构造函数
public class TestClass3
{

}
```

### 特性的目标

特性目标指的是应用特性的实体。例如，特性目标可以是类、特定方法或整个程序集。一般情况，特性应用于紧跟在它后面的元素。不过，C# 特性支持显示标识，例如可以显示标识为将特性应用于方法，或者是应用于其参数或返回值。

#### 语法

```
[target : attribute-list]
```

* target：表示指定的特性目标值。
* attribute-list：表示要应用的特性列表。

常用的 target 值：

| 目标值   | 适用对象                                  |
| -------- | ----------------------------------------- |
| assembly | 整个程序集                                |
| module   | 当前程序集模块                            |
| field    | 类或结构中的字段                          |
| event    | 事件                                      |
| method   | 方法或 get 和 set 属性访问器              |
| param    | 方法参数或 set 属性访问器参数             |
| property | Property（属性）                          |
| return   | 方法、属性索引器或 get 属性访问器的返回值 |
| type     | 结构、类、接口、枚举或委托                |

`例子`

```
// 默认: 应用于方法
[Test]
int Method1()
{ 
    return 0; 
}

// 显示指定应用于方法
[method: Test]
int Method2()
{ 
    return 0; 
}

// 应用于参数
int Method3([Test] string contract) 
{ 
    return 0; 
}

// 应用于返回值
[return: Test]
int Method4()
{ 
    return 0; 
}

```

## 预定义特性(C#中已有的特性)

.Net 框架提供了三种预定义特性：

- AttributeUsage
- Conditional
- Obsolete

### AttributeUsage

特性 AttributeUsage 描述了如何使用一个自定义特性类。注意，使用特性修饰的类 AttributeUsage 必须是 System.Attribute 的直接或间接派生类，否则将发生编译时错误。

#### 语法

```
[AttributeUsage(validon, AllowMultiple = allowmultiple, Inherited = inherited)]
```

* validon： 表示可被应用的特性目标值。它是枚举器 AttributeTargets 的值的组合。默认值是 AttributeTargets.All。
* AllowMultiple： 可选，allowmultiple 选项为其提供一个布尔值。表示特性是否能被重复放置多次
* Inherited：可选，inherited 选项为其提供一个布尔值。表示 能否被派生类所继承。

`例子`

```
[AttributeUsage(AttributeTargets.Class, AllowMultiple = false, Inherited = false)]
public class ExampleAttribute : Attribute
{
    public ExampleAttribute(string name)
    {
        
    }
}
```

### Conditional

特性 Conditional 是有条件的意思。使用特性修饰的方法也就是条件方法，条件方法的执行依赖于指定的预处理标识符。预处理标识符影响着方法调用的条件编译，这种影响取决于指定的值。例如事先用预处理器指令定义了一个 Test 字符，当条件方法指定的值也为 Test 时， 则该方法会被执行。

#### 语法

```
[Conditional(conditionalSymbol)]
```

`例子`

```
#define Test
using System;

public class Example
{
    [Conditional("Test")]
    static void Method1()
    {
        Console.WriteLine("Method1");
    }
    static void Method2()
    {
        Console.WriteLine("Method2");
    }

    static void Main()
    {
        Method1();
        Method2();
    }
}
```

### 其他常见预定特性

| 特性             | 说明                                                         |
| ---------------- | ------------------------------------------------------------ |
| [Obsolete]       | 标记已过时的代码，使得在使用过时成员时发出警告或错误信息。   |
| [Serializable]   | 用于标记类，表示该类可以序列化，即可以在网络上传输或者在文件中存储。 |
| [DllImport]      | 用于指示要在程序中调用非托管代码（通常是 DLL）的方法。       |
| [Conditional]    | 与预处理指令 ‘#if’ 和 ‘#endif’ 结合使用，根据定义的条件编译代码。 |
| [AttributeUsage] | 用于指定自定义特性的使用方式，如允许的目标类型和是否允许多次应用等。 |
| [Conditional]    | 根据条件编译代码，类似于预处理指令，但是使用 Attribute。     |
| [DefaultValue]   | 为属性或字段设置默认值。                                     |
| [Description]    | 为属性或者事件提供一个描述，通常在设计时使用。               |